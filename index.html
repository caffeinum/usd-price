<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>USD Price Tracker</title>
  <script src="https://cdn.plot.ly/plotly-latest.js"></script>
  <!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
  <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
  <script src="https://d3js.org/d3-fetch.v1.min.js"></script>

  <script type="text/javascript" language="javascript">
    const api_url = "/data.json"//https://blockchain.info/charts/market-price?format=json&timespan=60days"
    window.onload = function () {
      window.redraw = setInterval(updatePlot, 10000)
    };

    async function get(url) {
      const req = new XMLHttpRequest()
      return new Promise( (resolve, reject) => {
        req.open('GET', url, true)
        req.onreadystatechange = () => {
          if (req.readyState == 4) {
            if (req.status == 200) {
              resolve( JSON.parse(req.responseText) )
            } else {
              reject(req)
            }
          }
        }
        req.withCredentials = true
        req.setRequestHeader('X-PINGOTHER', 'pingpong')
        // req.setRequestHeader('Content-Type', 'application/json')
        req.send()
      })
    }
    async function updatePlot() {
      let price_plot = document.getElementById('price_plot')

      let trace = {
        x: [1,2,3,4,5],
        y: [1,2,4,8,16],
      }

      const data = await get(api_url)



      plotXY(price_plot, trace)
      console.log('updated', data)
    }

    function plotXY(plot, data) {
      data.type = 'scatter'

      Plotly.newPlot(price_plot, [ data ]);
    }
  </script>
  <style type="text/css">
  .price_plot {
    width: 800px;
    height: 500px;
  }
  </style>
</head>
<body>
  <h1 id="price"></h1>
  <div id="price_plot" class=""></div>
</body>
</html>
